<!-- 공통 네비게이션 바 -->
<div class="container-fluid">
    <a class="navbar-brand" href="index.html">
        <strong>Luxmax</strong>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
            <li class="nav-item">
                <a class="nav-link" href="index.html">
                    <i class="bi bi-house me-1"></i>홈
                </a>
            </li>
        </ul>
        <ul class="navbar-nav">
            <li class="nav-item">
                <button class="btn btn-link nav-link" onclick="requestPushPermission()">
                    <i class="bi bi-bell"></i>
                </button>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="cart.html">
                    <i class="bi bi-cart3"></i>
                    <span id="cartBadge" class="badge bg-danger">0</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" id="loginLink" onclick="handleLoginClick(event)">
                    <span id="login_text">
                        <i class="bi bi-box-arrow-in-left me-1"></i>로그인
                    </span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="mypage.html" id="mypageLink" style="display: none;">
                    <i class="bi bi-person-circle me-1"></i>마이페이지
                </a>
            </li>
        </ul>
    </div>
</div>

<script>
function requestPushPermission() {
    if (typeof braze !== 'undefined' && braze.requestPushPermission) {
        braze.requestPushPermission();
    } else {
        alert('푸시 알림 권한을 요청할 수 없습니다.');
    }
}

function handleLoginClick(event) {
    event.preventDefault();
    const userId = localStorage.getItem('lm.stroage.login.userId');
    
    if (userId) {
        // 로그아웃
        if (confirm('로그아웃하시겠습니까?')) {
            localStorage.removeItem('lm.stroage.login.userId');
            location.reload();
        }
    } else {
        // 로그인 페이지로 이동
        window.location.href = 'login.html';
    }
}

// 로그인 상태 확인 및 UI 업데이트
document.addEventListener('DOMContentLoaded', function() {
    const userId = localStorage.getItem('lm.stroage.login.userId');
    const loginLink = document.getElementById('loginLink');
    const loginText = document.getElementById('login_text');
    const mypageLink = document.getElementById('mypageLink');
    
    if (userId) {
        if (loginText) {
            loginText.innerHTML = '<i class="bi bi-box-arrow-right me-1"></i>로그아웃';
        }
        if (mypageLink) {
            mypageLink.style.display = 'block';
        }
    } else {
        if (loginText) {
            loginText.innerHTML = '<i class="bi bi-box-arrow-in-left me-1"></i>로그인';
        }
        if (mypageLink) {
            mypageLink.style.display = 'none';
        }
    }
    
    // 장바구니 배지 업데이트
    updateCartBadge();
});

function updateCartBadge() {
    const cartItems = JSON.parse(localStorage.getItem('lm.storage.item.cartItems') || '[]');
    const badge = document.getElementById('cartBadge');
    if (badge) {
        const totalQuantity = cartItems.reduce((sum, item) => sum + (item.quantity || 1), 0);
        badge.textContent = totalQuantity;
        badge.style.display = totalQuantity > 0 ? 'inline' : 'none';
    }
}
</script>
